theme(axis.text.x = element_text(angle = 45))
?scale_fill_brewer
eu9 %>%
pivot_longer(cols = c("freehms", "hmsfmlsh", "hmsacld"), names_to = "Question", values_to = "Answer") %>%
ggplot(aes(x=cntry, fill = as.factor(Answer))) +
geom_bar(position="fill") +
coord_flip()+
xlab("Riik")+
ylab("Osakaal")+
scale_fill_brewer(type = "div", name = "Vastus",
labels = c("1-Agree strongly", "2-Agree", "3-Neither agree nor disagree", "4-Disagree", "5-Disagree strongly"),
palette="PrGn",
na.value = "pink")+
facet_wrap(~Question, labeller = labeller(Question = c(`freehms`="Gays and lesbians free \n to live life as they wish",
`hmsfmlsh`="Ashamed if close family \n member gay or lesbian",
`hmsacld`="Gay and lesbian couples right \n to adopt children")))+
theme(strip.text.x = element_text( size = 6, color = "black", face = "bold.italic"))+
theme(axis.text.x = element_text(angle = 45))
?scale_fill_manual
eu9 %>%
pivot_longer(cols = c("freehms", "hmsfmlsh", "hmsacld"), names_to = "Question", values_to = "Answer") %>%
ggplot(aes(x=cntry, fill = as.factor(Answer))) +
geom_bar(position="fill") +
coord_flip()+
xlab("Riik")+
ylab("Osakaal")+
scale_fill_manual(type = "div", name = "Vastus",
labels = c("1-Agree strongly", "2-Agree", "3-Neither agree nor disagree", "4-Disagree", "5-Disagree strongly"),
values = c("darkgreen", "#F7F7F7", "#8E0152"),
na.value = "pink")+
facet_wrap(~Question, labeller = labeller(Question = c(`freehms`="Gays and lesbians free \n to live life as they wish",
`hmsfmlsh`="Ashamed if close family \n member gay or lesbian",
`hmsacld`="Gay and lesbian couples right \n to adopt children")))+
theme(strip.text.x = element_text( size = 6, color = "black", face = "bold.italic"))+
theme(axis.text.x = element_text(angle = 45))
eu9 %>%
pivot_longer(cols = c("freehms", "hmsfmlsh", "hmsacld"), names_to = "Question", values_to = "Answer") %>%
ggplot(aes(x=cntry, fill = as.factor(Answer))) +
geom_bar(position="fill") +
coord_flip()+
xlab("Riik")+
ylab("Osakaal")+
scale_fill_manual(name = "Vastus",
labels = c("1-Agree strongly", "2-Agree", "3-Neither agree nor disagree", "4-Disagree", "5-Disagree strongly"),
values = c("darkgreen", "#F7F7F7", "#8E0152"),
na.value = "pink")+
facet_wrap(~Question, labeller = labeller(Question = c(`freehms`="Gays and lesbians free \n to live life as they wish",
`hmsfmlsh`="Ashamed if close family \n member gay or lesbian",
`hmsacld`="Gay and lesbian couples right \n to adopt children")))+
theme(strip.text.x = element_text( size = 6, color = "black", face = "bold.italic"))+
theme(axis.text.x = element_text(angle = 45))
eu9 %>%
pivot_longer(cols = c("freehms", "hmsfmlsh", "hmsacld"), names_to = "Question", values_to = "Answer") %>%
ggplot(aes(x=cntry, fill = as.factor(Answer))) +
geom_bar(position="fill") +
coord_flip()+
xlab("Riik")+
ylab("Osakaal")+
scale_fill_manual(name = "Vastus",
labels = c("1-Agree strongly", "2-Agree", "3-Neither agree nor disagree", "4-Disagree", "5-Disagree strongly"),
values = c("darkgreen", "lightgreen", "#F7F7F7", "lightpurple", "#8E0152"),
na.value = "pink")+
facet_wrap(~Question, labeller = labeller(Question = c(`freehms`="Gays and lesbians free \n to live life as they wish",
`hmsfmlsh`="Ashamed if close family \n member gay or lesbian",
`hmsacld`="Gay and lesbian couples right \n to adopt children")))+
theme(strip.text.x = element_text( size = 6, color = "black", face = "bold.italic"))+
theme(axis.text.x = element_text(angle = 45))
eu9 %>%
pivot_longer(cols = c("freehms", "hmsfmlsh", "hmsacld"), names_to = "Question", values_to = "Answer") %>%
ggplot(aes(x=cntry, fill = as.factor(Answer))) +
geom_bar(position="fill") +
coord_flip()+
xlab("Riik")+
ylab("Osakaal")+
scale_fill_manual(name = "Vastus",
labels = c("1-Agree strongly", "2-Agree", "3-Neither agree nor disagree", "4-Disagree", "5-Disagree strongly"),
values = c("darkgreen", "lightgreen", "#F7F7F7", "CC99FF", "#8E0152"),
na.value = "pink")+
facet_wrap(~Question, labeller = labeller(Question = c(`freehms`="Gays and lesbians free \n to live life as they wish",
`hmsfmlsh`="Ashamed if close family \n member gay or lesbian",
`hmsacld`="Gay and lesbian couples right \n to adopt children")))+
theme(strip.text.x = element_text( size = 6, color = "black", face = "bold.italic"))+
theme(axis.text.x = element_text(angle = 45))
eu9 %>%
pivot_longer(cols = c("freehms", "hmsfmlsh", "hmsacld"), names_to = "Question", values_to = "Answer") %>%
ggplot(aes(x=cntry, fill = as.factor(Answer))) +
geom_bar(position="fill") +
coord_flip()+
xlab("Riik")+
ylab("Osakaal")+
scale_fill_manual(name = "Vastus",
labels = c("1-Agree strongly", "2-Agree", "3-Neither agree nor disagree", "4-Disagree", "5-Disagree strongly"),
values = c("darkgreen", "lightgreen", "#F7F7F7", "#CC99FF", "#8E0152"),
na.value = "pink")+
facet_wrap(~Question, labeller = labeller(Question = c(`freehms`="Gays and lesbians free \n to live life as they wish",
`hmsfmlsh`="Ashamed if close family \n member gay or lesbian",
`hmsacld`="Gay and lesbian couples right \n to adopt children")))+
theme(strip.text.x = element_text( size = 6, color = "black", face = "bold.italic"))+
theme(axis.text.x = element_text(angle = 45))
eu9 %>%
pivot_longer(cols = c("freehms", "hmsfmlsh", "hmsacld"), names_to = "Question", values_to = "Answer") %>%
ggplot(aes(x=cntry, fill = as.factor(Answer))) +
geom_bar(position="fill") +
coord_flip()+
xlab("Riik")+
ylab("Osakaal")+
scale_fill_manual(name = "Vastus",
labels = c("1-Agree strongly", "2-Agree", "3-Neither agree nor disagree", "4-Disagree", "5-Disagree strongly"),
values = c("darkgreen", "lightgreen", "#F7F7F7", "#CC99FF", "#8E0152"),
na.value = "gray20")+
facet_wrap(~Question, labeller = labeller(Question = c(`freehms`="Gays and lesbians free \n to live life as they wish",
`hmsfmlsh`="Ashamed if close family \n member gay or lesbian",
`hmsacld`="Gay and lesbian couples right \n to adopt children")))+
theme(strip.text.x = element_text( size = 6, color = "black", face = "bold.italic"))+
theme(axis.text.x = element_text(angle = 45))
cntry_raw_plt <- eu9 %>%
pivot_longer(cols = c("freehms", "hmsfmlsh", "hmsacld"), names_to = "Question", values_to = "Answer") %>%
ggplot(aes(x=cntry, fill = as.factor(Answer))) +
geom_bar(position="fill") +
coord_flip()+
xlab("Riik")+
ylab("Osakaal")+
scale_fill_manual(name = "Vastus",
labels = c("1-Agree strongly", "2-Agree", "3-Neither agree nor disagree", "4-Disagree", "5-Disagree strongly"),
values = c("darkgreen", "lightgreen", "#F7F7F7", "#CC99FF", "#8E0152"),
na.value = "gray20")+
facet_wrap(~Question, labeller = labeller(Question = c(`freehms`="Gays and lesbians free \n to live life as they wish",
`hmsfmlsh`="Ashamed if close family \n member gay or lesbian",
`hmsacld`="Gay and lesbian couples right \n to adopt children")))+
theme(strip.text.x = element_text( size = 6, color = "black", face = "bold.italic"))+
theme(axis.text.x = element_text(angle = 45))
ggsave("agg_cluster_plot2.png_2", cntry_raw_plt, device = "png", height = 12, width = 20, units = c("cm"))
cntry_raw_plt <- eu9 %>%
pivot_longer(cols = c("freehms", "hmsfmlsh", "hmsacld"), names_to = "Question", values_to = "Answer") %>%
ggplot(aes(x=cntry, fill = as.factor(Answer))) +
geom_bar(position="fill") +
coord_flip()+
xlab("Riik")+
ylab("Osakaal")+
scale_fill_manual(name = "Vastus",
labels = c("1-Agree strongly", "2-Agree", "3-Neither agree nor disagree", "4-Disagree", "5-Disagree strongly"),
values = c("darkgreen", "lightgreen", "#F7F7F7", "#CC99FF", "#8E0152"),
na.value = "gray20")+
facet_wrap(~Question, labeller = labeller(Question = c(`freehms`="Gays and lesbians free \n to live life as they wish",
`hmsfmlsh`="Ashamed if close family \n member gay or lesbian",
`hmsacld`="Gay and lesbian couples right \n to adopt children")))+
theme(strip.text.x = element_text( size = 6, color = "black", face = "bold.italic"))+
theme(axis.text.x = element_text(angle = 45))
ggsave("agg_cluster_plot2.png", cntry_raw_plt, device = "png", height = 12, width = 20, units = c("cm"))
set_email("siimpoldre@gmail.com")
eu9 <- import_rounds(9, format="spss")
eu9 <- eu9 %>%
select(cntry, freehms, hmsfmlsh, hmsacld, pspwght)
#Teeme võrdleva ploti toorestest vastustest
cntry_raw_plt <- eu9 %>%
pivot_longer(cols = c("freehms", "hmsfmlsh", "hmsacld"), names_to = "Question", values_to = "Answer") %>%
ggplot(aes(x=cntry, fill = as.factor(Answer))) +
geom_bar(position="fill") +
coord_flip()+
xlab("Riik")+
ylab("Osakaal")+
scale_fill_manual(name = "Vastus",
labels = c("1-Agree strongly", "2-Agree", "3-Neither agree nor disagree", "4-Disagree", "5-Disagree strongly"),
values = c("darkgreen", "lightgreen", "#F7F7F7", "#CC99FF", "#8E0152"),
na.value = "gray20")+
facet_wrap(~Question, labeller = labeller(Question = c(`freehms`="Gays and lesbians free \n to live life as they wish",
`hmsfmlsh`="Ashamed if close family \n member gay or lesbian",
`hmsacld`="Gay and lesbian couples right \n to adopt children")))+
theme(strip.text.x = element_text( size = 6, color = "black", face = "bold.italic"))+
theme(axis.text.x = element_text(angle = 45))
ggsave("agg_cluster_plot2.png", cntry_raw_plt, device = "png", height = 12, width = 20, units = c("cm"))
#Võtame kaalutud keskmise
eu9_agg <- eu9 %>%
group_by(cntry) %>%
summarise(freehms_mean = weighted.mean(as.numeric(freehms), na.rm=T, w = pspwght),
hmsfmlsh_mean = weighted.mean(as.numeric(hmsfmlsh), na.rm=T, w = pspwght),
hmsacld_mean = weighted.mean(as.numeric(hmsacld), na.rm=T, w = pspwght))
#eu9_agg <-eu9_agg %>%
#mutate(freehms_mean = scale(freehms_mean),
#hmsfmlsh_mean = scale(hmsfmlsh_mean),
#hmsacld_mean = scale(hmsacld_mean))
agg_plot <-eu9_agg %>%
pivot_longer(cols = c("freehms_mean", "hmsfmlsh_mean", "hmsacld_mean"), names_to = "Question", values_to = "Mean score") %>%
ggplot(aes(x=cntry, y = `Mean score`, color = Question, group = Question)) +
geom_point()+
geom_line()+
xlab("Riik")+
ylab("Keskmine skoor")+
scale_color_brewer(name = "Küsimus",
labels = c("Gays and lesbians free \n to live life as they wish",
"Ashamed if close family \n member gay or lesbian",
"Gay and lesbian couples right \n to adopt children"),
palette="Dark2")+
theme(legend.position = "top") +
annotate("text", x = 1, y = 4.8,
label = "Keskmine põhineb skaalal: \n 1 - Agree Strongly \n 5 - Disagree strongly",
hjust = 0)
ggsave("agg_cluster_plot_1.png", agg_plot, device = "png", height = 9, width = 10)
cluster_map <- europe_map %>%
right_join(clusters) %>%
mutate(cluster = as.factor(cluster)) %>%
ggplot() +
geom_sf(aes(fill = factor(cluster))) +
theme_void()+
scale_fill_manual(values = c("#E31A1C", "#6A3D9A", "#CAB2D6", "#FB9A99"), name = "Cluster")
cluster_map2 <- europe_map %>%
right_join(clusters) %>%
mutate(cluster = as.factor(cluster)) %>%
ggplot() +
geom_sf(aes(fill = factor(cluster))) +
theme_void()+
scale_fill_manual(values = c("#E31A1C", "#6A3D9A", "#CAB2D6", "#FB9A99"), name = "Cluster")
cluster_map
ggsave("cluster_map2.png", cluster_map)
eu9_agg <-eu9_agg %>%
mutate(freehms_mean = scale(freehms_mean),
hmsfmlsh_mean = scale(hmsfmlsh_mean),
hmsacld_mean = scale(hmsacld_mean))
eu9_agg
eu9_agg_rows <- eu9_agg$cntry
eu9_agg_rows
agg_mat <- eu9_agg %>%
select(freehms_mean, hmsfmlsh_mean, hmsacld_mean) %>%
as.matrix()
eu9_rows <- data.frame(Question = factor(c("Gays and lesbians free to live life as they wish",
"Ashamed if close family member gay or lesbian",
"Gay and lesbian couples right to adopt children")))
rownames(eu9_rows) <- colnames(agg_mat)
rownames(agg_mat) <- eu9_agg_rows
d_agg <- stats::dist(agg_mat)
d_agg_comp <- hclust(d_agg, method = "complete")
clusters <- as.data.frame(cutree(d_agg_comp, 4)) %>%
rownames_to_column() %>%
rename(iso_a2 = rowname, cluster = `cutree(d_agg_comp, 4)`)
col_anns <- as.data.frame(cutree(d_agg_comp, 4)) %>%
rename(Cluster = `cutree(d_agg_comp, 4)`) %>%
mutate(Cluster = as.character(Cluster))
comp_heat <- pheatmap(t(agg_mat),
main = "ESS heatmap",
show_rownames = F,
show_colnames = T,
cluster_rows = F,
clustering_distance_col = "euclidean",
clustering_method = "complete",
angle_col = 45,
display_numbers = T,
fontsize_number = 7,
number_color = "black",
cutree_cols = 4,
cellheight = 35,
cellwidth = 16,
annotation_row = eu9_rows,
annotation_col = col_anns,
legend_breaks = c(1.5, 4.5),
legend_labels = c("Agree strongly","Disagree strongly"),
color = colorRampPalette(c("darkgreen", "#F7F7F7", "#8E0152"))(99),
annotation_colors = list(Question = c(`Gays and lesbians free to live life as they wish` = "#1B9E77",
`Ashamed if close family member gay or lesbian` = "#D95F02",
`Gay and lesbian couples right to adopt children` = "#7570B3"),
Cluster = c(`1` = "#E31A1C",
`2` = "#6A3D9A",
`3` = "#CAB2D6",
`4` = "#FB9A99")),
filename = "Ess_heat1_2.png",
height = 9,
width = 15.5)
comp_heat <- pheatmap(t(agg_mat),
main = "ESS heatmap",
show_rownames = F,
show_colnames = T,
cluster_rows = F,
clustering_distance_col = "euclidean",
clustering_method = "complete",
angle_col = 45,
display_numbers = T,
fontsize_number = 7,
number_color = "black",
cutree_cols = 4,
cellheight = 35,
cellwidth = 16,
annotation_row = eu9_rows,
annotation_col = col_anns,
legend_breaks = c(-2, 4.5),
legend_labels = c("Agree strongly","Disagree strongly"),
color = colorRampPalette(c("darkgreen", "#F7F7F7", "#8E0152"))(99),
annotation_colors = list(Question = c(`Gays and lesbians free to live life as they wish` = "#1B9E77",
`Ashamed if close family member gay or lesbian` = "#D95F02",
`Gay and lesbian couples right to adopt children` = "#7570B3"),
Cluster = c(`1` = "#E31A1C",
`2` = "#6A3D9A",
`3` = "#CAB2D6",
`4` = "#FB9A99")),
filename = "Ess_heat1_2.png",
height = 9,
width = 15.5)
eu9_agg <- eu9 %>%
group_by(cntry) %>%
summarise(freehms_mean = weighted.mean(as.numeric(freehms), na.rm=T, w = pspwght),
hmsfmlsh_mean = weighted.mean(as.numeric(hmsfmlsh), na.rm=T, w = pspwght),
hmsacld_mean = weighted.mean(as.numeric(hmsacld), na.rm=T, w = pspwght))
eu9_agg <- eu9 %>%
group_by(cntry) %>%
summarise(freehms_mean = weighted.mean(as.numeric(freehms), na.rm=T, w = pspwght),
hmsfmlsh_mean = weighted.mean(as.numeric(hmsfmlsh), na.rm=T, w = pspwght),
hmsacld_mean = weighted.mean(as.numeric(hmsacld), na.rm=T, w = pspwght))
eu9_agg_scaled <-eu9_agg %>%
mutate(freehms_mean = scale(freehms_mean),
hmsfmlsh_mean = scale(hmsfmlsh_mean),
hmsacld_mean = scale(hmsacld_mean))
cbind(eu9_agg, eu9_agg_scaled)
comp_heat <- pheatmap(t(agg_mat),
main = "ESS heatmap",
show_rownames = F,
show_colnames = T,
cluster_rows = F,
clustering_distance_col = "euclidean",
clustering_method = "complete",
angle_col = 45,
fontsize_number = 7,
number_color = "black",
cutree_cols = 4,
cellheight = 35,
cellwidth = 16,
annotation_row = eu9_rows,
annotation_col = col_anns,
legend_breaks = c(-2, 4.5),
legend_labels = c("Agree strongly","Disagree strongly"),
color = colorRampPalette(c("darkgreen", "#F7F7F7", "#8E0152"))(99),
annotation_colors = list(Question = c(`Gays and lesbians free to live life as they wish` = "#1B9E77",
`Ashamed if close family member gay or lesbian` = "#D95F02",
`Gay and lesbian couples right to adopt children` = "#7570B3"),
Cluster = c(`1` = "#E31A1C",
`2` = "#6A3D9A",
`3` = "#CAB2D6",
`4` = "#FB9A99")),
filename = "Ess_heat1_2.png",
height = 9,
width = 15.5)
knitr::opts_chunk$set(echo = TRUE)
andm <- read.csv2("http://www.ut.ee/~indrekso/syndmusanalnaide2.csv")
andm
fit <- survfit(Surv(aeg, syndmus) ~ 1, data = andm)
install.packages("survival")
library(survival)
fit <- survfit(Surv(aeg, syndmus) ~ 1, data = andm)
summary(fit)
plot(fit, conf.int = F, mark.time = F)
plot(fit, conf.int = F, mark.time = T)
plot(fit, conf.int = T, mark.time = T)
library(essurvey)
set_email("siimpoldre@gmail.com")
ee9 <- import_country(country = "Estonia", rounds = 9)
library(weights)
install.packages("weights")
library(weights)
wtd.hist(ee9$fcldbrn, weight = ee9$pspwght)
ee9$fcldage <- ee9$fcldbrn - ee9$yrbrn
wtd.hist(ee9$fcldage, weight = ee9$pspwght, breaks = 25, freq = T)
wtd.hist(ee9$fcldage, weight = ee9$pspwght, breaks = 25, freq = T)
library(descr)
descr::freq(ee9$fcldage, w = ee9$pspwght)
str(ee9$bthcld)
attributes(ee9$bthcld)
ee9$bthcld01 <- ee9$bthcld
ee9$bthcld01[ee9$bthcld == 2] <- 0
descr::freq(ee9$bthcld, w = ee9$pspwght)
descr::freq(ee9$bthcld01, w = ee9$pspwght)
fit2 <- survfit(Surv(fcldage, bthcld01) ~ 1, data = ee9, weights = pspwght)
summary(fit2)
attributes(ee9$bthcld)
ee9$bthcld01 <- ee9$bthcld
ee9$bthcld01[ee9$bthcld == 2] <- 0
descr::freq(ee9$bthcld, w = ee9$pspwght)
descr::freq(ee9$bthcld01, w = ee9$pspwght)
ee9$bthcld01[ee9$bthcld == 2] <- 0
descr::freq(ee9$bthcld01, w = ee9$pspwght)
ee9 <- import_country(country = "Estonia", rounds = 9, format "SPSS")
ee9 <- import_country(country = "Estonia", rounds = 9, format "spss")
ee9 <- import_country(country = "Estonia", rounds = 9, format= "spss")
ee9$fcldage <- ee9$fcldbrn - ee9$yrbrn
wtd.hist(ee9$fcldage, weight = ee9$pspwght, breaks = 25, freq = T)
library(descr)
descr::freq(ee9$fcldage, w = ee9$pspwght)
str(ee9$bthcld)
attributes(ee9$bthcld)
ee9$bthcld01 <- ee9$bthcld
#Peame tegema 0-1 tunnuse, sest järjekord peaks olema, et No on 0, aga siin on 1.
ee9$bthcld01[ee9$bthcld == 2] <- 0
descr::freq(ee9$bthcld, w = ee9$pspwght)
descr::freq(ee9$bthcld01, w = ee9$pspwght)
fit2 <- survfit(Surv(fcldage, bthcld01) ~ 1, data = ee9, weights = pspwght)
summary(fit2)
plot(fit2, conf.int = T, mark.time = T)
ee9$fcldage2 <- ee9$fcldage
ee9$fcldage2[ee9$bthcld01 == 0] <- ee9$agea[ee9$bthcld01 == 0]
descr::freq(ee9$fcldage2, w = ee9$pspwght)
fit3 <- survfit(Surv(fcldage2, bthcld01) ~ 1, data = ee9, weights = pspwght)
summary(fit3)
plot(fit3, conf.int = T, mark.time = F, xlim = c(0,51))
jätame välja indiviidid, kelle puhul võiks olla kindel, et nad lapsi enam ei saa
ee9_41 <- ee9[ee9$agea <= 41 | ee9$bthcld01 == 1,]
fit5 <- survfit(Surv(fcldage2, bthcld01) ~ 1, data = ee9_41, weights = pspwght)
summary(fit5)
plot(fit5, conf.int = T, mark.time = F, xlim = c(0,51))
ee9_41$yrbrncat <- cut(ee9_41$yrbrn, c(1928, 1960, 1980, 2003))
ee9_41$yrbrncat <- cut(ee9_41$yrbrn, c(1928, 1960, 1980, 2003))
fit_yrbrn <- survfit(Surv(fcldage2, bthcld01) ~ yrbrncat, data = ee9_41, weights = pspwght)
summary(fit_yrbrn)
plot(fit_yrbrn, col = c("red", "green", "blue"), conf.int = T, mark.time = F, xlim = c(0,51))
library(survminer)
ggsurvplot(fit_yrbrn, data = ee9_41, conf.int = TRUE,
censor = F,
legend.labs = c("1928-60", "1961-80", "1981-2003"),
surv.median.line = "hv",
ggtheme = theme_minimal())
ggsurvplot(fit_yrbrn, data = ee9_41, conf.int = TRUE,
censor = F, #meid ei huvita tsenseeritud inimesed
legend.labs = c("1928-60", "1961-80", "1981-2003"),
surv.median.line = "hv", #tahame mediaaniväärtusied ka
ggtheme = theme_minimal(),
xlim=15)
ggsurvplot(fit_yrbrn, data = ee9_41, conf.int = TRUE,
censor = F, #meid ei huvita tsenseeritud inimesed
legend.labs = c("1928-60", "1961-80", "1981-2003"),
surv.median.line = "hv", #tahame mediaaniväärtusied ka
ggtheme = theme_minimal(),
xlim="15")
ggsurvplot(fit_yrbrn, data = ee9_41, conf.int = TRUE,
censor = F, #meid ei huvita tsenseeritud inimesed
legend.labs = c("1928-60", "1961-80", "1981-2003"),
surv.median.line = "hv", #tahame mediaaniväärtusied ka
ggtheme = theme_minimal(),
xlim=c(15,55))
ggsurvplot(fit_yrbrn, data = ee9_41, conf.int = TRUE,
censor = F, #meid ei huvita tsenseeritud inimesed
legend.labs = c("1928-60", "1961-80", "1981-2003"),
surv.median.line = "hv", #tahame mediaaniväärtusied ka
ggtheme = theme_minimal(),
xlim=c(20,55))
ggsurvplot(fit_yrbrn, data = ee9_41, conf.int = TRUE,
censor = F, #meid ei huvita tsenseeritud inimesed
legend.labs = c("1928-60", "1961-80", "1981-2003"),
surv.median.line = "hv", #tahame mediaaniväärtusied ka
ggtheme = theme_minimal())
ee9_41$eduyrscat <- cut(ee9_41$eduyrs, c(0, 9, 12, 15, 30))
fit_eduyrs <- survfit(Surv(fcldage2, bthcld01) ~ eduyrscat, data = ee9_41, weights = pspwght)
plot(fit_eduyrs, col = c("black", "red", "blue", "green"))
ggsurvplot(fit_eduyrs, data = ee9_41, conf.int = TRUE,
censor = F,
legend.labs = c("0-9", "10-12", "13-15", "16+"),
surv.median.line = "hv",
ggtheme = theme_minimal())
survdiff(Surv(fcldage2, bthcld01) ~ yrbrncat, data = ee9_41)
survdiff(Surv(fcldage2, bthcld01) ~ eduyrscat, data = ee9_41)
survdiff(Surv(fcldage2, bthcld01) ~ eduyrscat, data = subset(ee9_41, eduyrs <= 12))
survdiff(Surv(fcldage2, bthcld01) ~ eduyrscat, data = subset(ee9_41, eduyrs > 12))
survdiff(Surv(fcldage2, bthcld01) ~ yrbrncat, data = ee9_41)
survdiff(Surv(fcldage2, bthcld01) ~ eduyrscat, data = ee9_41)
#Võrdleme ainult kahte gruppi
survdiff(Surv(fcldage2, bthcld01) ~ eduyrscat, data = subset(ee9_41, eduyrs <= 12))
survdiff(Surv(fcldage2, bthcld01) ~ eduyrscat, data = subset(ee9_41, eduyrs > 12))
knitr::opts_chunk$set(echo = TRUE)
curl_fetch_memory("https://avaandmed.eesti.ee/api/datasets/d43cbb24-f58f-4928-b7ed-1fcec2ef355b/files/51278edd-f3ff-4eab-b954-743dbd51e479/download-s3")
library(curl)
curl_fetch_memory("https://avaandmed.eesti.ee/api/datasets/d43cbb24-f58f-4928-b7ed-1fcec2ef355b/files/51278edd-f3ff-4eab-b954-743dbd51e479/download-s3")
?curl()
library(httr)
r <- POST('https://avaandmed.eesti.ee/api/datasets/d43cbb24-f58f-4928-b7ed-1fcec2ef355b/files/51278edd-f3ff-4eab-b954-743dbd51e479/download-s3')
View(r)
stop_for_status(r)
content(r, "parsed", "application/json")
content(r, "parsed")
content(r)
POST('https://avaandmed.eesti.ee/api/datasets/d43cbb24-f58f-4928-b7ed-1fcec2ef355b/files/51278edd-f3ff-4eab-b954-743dbd51e479/download-s3', encode = "form", write_disk("/tmp/ishares-us-etf.xls"))
ee9_41$gndr01 <- ee9_41$gndr
ee9_41$gndr01[ee9_41$gndr == 2] <- 1
ee9_41$gndr01[ee9_41$gndr == 1] <- 0
ee9_41$gndr01 <- as.factor(ee9_41$gndr01)
coxmod1 <- coxph(Surv(fcldage2, bthcld01) ~ gndr, data = ee9_41, weights = pspwght)
summary(coxmod1)
coxmod2 <- coxph(Surv(fcldage2, bthcld01) ~ gndr01 + eduyrs + yrbrn, data = ee9_41, weights = pspwght)
summary(coxmod2)
ggsurvplot(survfit(coxmod2), data = ee9_41,
censor = F,
surv.median.line = "hv",
ggtheme = theme_minimal())
gndr01_df <- with(ee9_41,
data.frame(gndr01 = as.factor(c(0, 1)),
eduyrs = rep(weighted.mean(eduyrs, w = pspwght, na.rm = TRUE), 2),
yrbrn = rep(weighted.mean(yrbrn, w = pspwght, na.rm = TRUE), 2)
)
gndr01_df <- with(ee9_41,
gndr01_df <- with(ee9_41,
data.frame(gndr01 = as.factor(c(0, 1)),
eduyrs = rep(weighted.mean(eduyrs, w = pspwght, na.rm = TRUE), 2),
yrbrn = rep(weighted.mean(yrbrn, w = pspwght, na.rm = TRUE), 2)
)
)
gndr01_df
fit <- survfit(coxmod2, newdata = gndr01_df)
ggsurvplot(fit, data = gndr01_df, conf.int = TRUE,
censor = F,
legend.labs=c("Mehed", "Naised"),
surv.median.line = "hv",
ggtheme = theme_minimal())
ggcoxzph(test_ph, var = "gndr01")
```{r}
test_ph <- cox.zph(coxmod2)
test_ph
ggcoxzph(test_ph, var = "gndr01")
ggcoxzph(test_ph, var = "eduyrs")
ggcoxzph(test_ph, var = "yrbrn")
